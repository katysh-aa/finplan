<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>๐ฐ ะกะตะผะตะนะฝัะน ะฑัะดะถะตั</title>
    <link rel="stylesheet" href="style.css" />
    <!-- ะะบะพะฝะบะฐ ะฟัะธะปะพะถะตะฝะธั -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS ะดะปั Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- ะะฝะดะธะบะฐัะพั pull-to-refresh -->
    <div id="refresh-indicator" style="
        position: absolute;
        top: -50px;
        left: 0;
        width: 100%;
        height: 50px;
        background: white;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001;
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
    ">
        <span style="color: #007AFF; font-size: 14px;">๐ ะะฑะฝะพะฒะปะตะฝะธะต...</span>
    </div>

    <!-- ะญะบัะฐะฝ ะฒัะพะดะฐ -->
    <section id="auth-screen" style="text-align: center; padding: 40px 20px;">
        <h2>๐ ะัะพะด ะฒ ะกะตะผะตะนะฝัะน ะฑัะดะถะตั</h2>
        <p>ะะฒะตะดะธัะต email ะธ ะฟะฐัะพะปั</p>
        <form id="login-form" style="display: grid; gap: 12px; max-width: 300px; margin: 20px auto;">
            <input type="email" id="login-email" placeholder="Email" required />
            <input type="password" id="login-password" placeholder="ะะฐัะพะปั" required />
            <button type="submit" class="btn">ะะพะนัะธ</button>
        </form>
        <p id="auth-error" style="color: #ff3b30; height: 20px; font-size: 14px;"></p>
    </section>

    <!-- ะัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต -->
    <div id="app" style="display: none;">
        <section id="home">
            <!-- ะะฝะพะฟะบะฐ ะฒััะพะดะฐ ะฒ ะฟัะฐะฒะพะผ ะฒะตััะฝะตะผ ัะณะปั -->
            <div style="position: absolute; top: 20px; right: 20px; z-index: 10;">
                <button onclick="logout()" class="btn" style="
                    background: transparent;
                    color: #007AFF;
                    font-size: 14px;
                    padding: 8px 12px;
                    border: 1px solid #007AFF;
                    border-radius: 8px;
                    width: auto;
                " title="ะัะนัะธ ะธะท ะฐะบะบะฐัะฝัะฐ">๐ช</button>
            </div>

            <h1>๐ฐ ะะปะฐะฒะฝะฐั</h1>
            <div style="margin-top: 20px; padding: 12px; background: #f8f8f8; border-radius: 10px;">
                <label style="display: block; margin-bottom: 8px;"><strong>ะฃััะฐะฝะพะฒะธัะต ัะตะปั:</strong></label>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="number" id="savings-goal" value="500000" placeholder="500000"
                        style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px;" />
                    <button onclick="saveGoal()" class="btn" style="font-size: 14px; padding: 10px 12px;">๐พ
                        ะกะพััะฐะฝะธัั</button>
                </div>
            </div>
            <h2>๐ฏ ะฆะตะปั ะฝะฐะบะพะฟะปะตะฝะธะน</h2>
            <div
                style="background: #f0f8ff; padding: 18px; border-radius: 12px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                <p style="font-size: 28px; font-weight: bold; color: #34c759;" id="total-savings">0 โฝ</p>
                <p style="color: #666; font-size: 14px;" id="progress-text">0% ะพั ัะตะปะธ</p>
                <div style="height: 6px; background: #ddd; border-radius: 3px; overflow: hidden; margin: 10px 0;">
                    <div id="progress-fill" style="height: 100%; width: 0%; background: #34c759;"></div>
                </div>
            </div>
            <h2 style="margin-top: 30px;">๐ ะะฑัะธะน ะฟัะพะณัะตัั</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px;">
                <div style="text-align: center; background: #e6f7ff; padding: 14px; border-radius: 10px;">
                    <p style="margin: 0; color: #007AFF;"><strong>ะะพัะพะด</strong></p>
                    <p style="margin: 8px 0 0; font-size: 18px; color: #34c759;" id="total-income">0 โฝ</p>
                </div>
                <div style="text-align: center; background: #fff3e0; padding: 14px; border-radius: 10px;">
                    <p style="margin: 0; color: #FF9500;"><strong>ะะฐััะพะด</strong></p>
                    <p style="margin: 8px 0 0; font-size: 18px; color: #ff3b30;" id="total-expense">0 โฝ</p>
                </div>
            </div>
        </section>

        <section id="add" style="display: none;">
            <h2>โ ะะพะฑะฐะฒะธัั ะพะฟะตัะฐัะธั</h2>
            <form id="add-form">
                <input type="date" id="date" required />
                <select id="category" required>
                    <option value="">โ ะะฐัะตะณะพัะธั โ</option>
                    <option value="ะะฐัะฟะปะฐัะฐ">๐ผ ะะฐัะฟะปะฐัะฐ</option>
                    <option value="ะะพะดัะฐะฑะพัะบะฐ">๐ง ะะพะดัะฐะฑะพัะบะฐ</option>
                    <option value="ะัะพะดัะบัั">๐ ะัะพะดัะบัั</option>
                    <option value="ะขัะฐะฝัะฟะพัั">๐ ะขัะฐะฝัะฟะพัั</option>
                    <option value="ะะธะปัั">๐ ะะธะปัั</option>
                    <option value="ะะฐะทะฒะปะตัะตะฝะธั">๐ฎ ะะฐะทะฒะปะตัะตะฝะธั</option>
                    <option value="ะะดะพัะพะฒัะต">๐ ะะดะพัะพะฒัะต</option>
                    <option value="ะะฑัะฐะทะพะฒะฐะฝะธะต">๐ ะะฑัะฐะทะพะฒะฐะฝะธะต</option>
                    <option value="ะะพะดะฐัะบะธ">๐ ะะพะดะฐัะบะธ</option>
                    <option value="ะัะพัะตะต">๐ฆ ะัะพัะตะต</option>
                </select>
                <input type="number" id="amount" placeholder="ะกัะผะผะฐ" step="0.01" required />
                <select id="type" required>
                    <option value="income">๐ข ะะพัะพะด</option>
                    <option value="expense">๐ด ะะฐััะพะด</option>
                </select>
                <select id="author" required>
                    <option value="ะะฝัะพะฝ">๐จ ะะฝัะพะฝ</option>
                    <option value="ะะธะฑะตะบ">๐ฉ ะะธะฑะตะบ</option>
                </select>
                <button type="submit" class="btn">ะกะพััะฐะฝะธัั</button>
            </form>
            <h3>ะะพัะปะตะดะฝะธะต 10 ะพะฟะตัะฐัะธะน</h3>
            <ul id="recent-transactions"></ul>
        </section>

        <section id="plan" style="display: none;">
            <h2>๐ ะคะธะฝะฐะฝัะพะฒัะน ะฟะปะฐะฝ</h2>
            <p style="color: #666; font-size: 14px;">ะะฐะฟะปะฐะฝะธััะนัะต ะดะพัะพะดั ะธ ัะฐััะพะดั ะฟะพ ะผะตัััะฐะผ. ะะฐะฝะฝัะต ัะธะฝััะพะฝะธะทะธัััััั
                ะฝะฐ ะฒัะตั ััััะพะนััะฒะฐั.</p>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
                <h3>โ ะะฒะตััะธ ะฒัััะฝัั</h3>
                <form id="plan-form" style="display: grid; gap: 12px;">
                    <select id="plan-month" required
                        style="padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    </select>
                    <input type="number" id="plan-income" placeholder="ะะปะฐะฝะธััะตะผัะน ะดะพัะพะด (โฝ)" step="0.01" required />
                    <input type="number" id="plan-expense" placeholder="ะะปะฐะฝะธััะตะผัะต ัะฐััะพะดั (โฝ)" step="0.01" required />
                    <button type="submit" class="btn">๐พ ะกะพััะฐะฝะธัั</button>
                </form>
            </div>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
                <h3>๐ฅ ะะผะฟะพัั ะธะท Excel</h3>
                <p style="font-size: 14px; color: #666;">ะคะพัะผะฐั: <code>ะะตััั (ะะะะ-ะะ), ะะพัะพะด, ะะฐััะพะด</code></p>
                <input type="file" id="import-plan-file" accept=".xlsx, .xls" />
                <button onclick="importPlanFromExcel()" class="btn"
                    style="font-size: 14px; padding: 10px; margin-top: 8px;">ะะฐะณััะทะธัั</button>
            </div>
            <h3>๐ ะขะตะบััะธะต ะฟะปะฐะฝั</h3>
            <ul id="plan-list"></ul>
        </section>

        <section id="list" style="display: none;">
            <h2>๐ ะััะพัะธั ะพะฟะตัะฐัะธะน</h2>
            <div style="display: grid; gap: 10px; margin: 10px 0;">
                <input type="date" id="filter-start" placeholder="ะก ะดะฐัั" />
                <input type="date" id="filter-end" placeholder="ะะพ ะดะฐัั" />
            </div>
            <div style="margin: 10px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="filterByDate()" class="btn"
                    style="font-size: 14px; padding: 10px; flex: 1; min-width: 120px;">๐
                    ะคะธะปัััะพะฒะฐัั</button>
                <button onclick="clearFilter()" class="btn"
                    style="font-size: 14px; padding: 10px; flex: 1; min-width: 120px; background: #555;">๐๏ธ
                    ะกะฑัะพัะธัั</button>
                <button onclick="exportToExcel()" class="btn" style="font-size: 14px; background: #2e74b5;">๐ฅ ะญะบัะฟะพัั ะฒ
                    Excel</button>
            </div>
            <ul id="all-transactions"></ul>
        </section>

        <section id="analytics" style="display: none;">
            <h2>๐ ะััะตั</h2>
            <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>๐ฏ ะคะธะฝะฐะฝัะพะฒัะน ะฟะปะฐะฝ ะฝะฐ ะผะตััั</h3>
                <p><strong>๐ ะขะตะบััะธะน ะผะตััั:</strong> <span id="current-month">ะะฐะณััะทะบะฐ...</span></p>
                <div style="margin-top: 10px; padding: 10px; background: #e6f7ff; border-radius: 8px;">
                    <p><strong>๐ผ ะะพัะพะด (ะฟะปะฐะฝ):</strong> <span id="plan-income-value">โ โฝ</span></p>
                    <p><strong>๐ผ ะะพัะพะด (ัะฐะบั):</strong> <span id="fact-income-value">0 โฝ</span></p>
                    <div style="height: 6px; background: #ddd; border-radius: 3px; margin: 5px 0;">
                        <div id="progress-income-bar" style="height: 100%; width: 0%; background: #34c759;"></div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 8px;">
                    <p><strong>๐ธ ะะฐััะพะด (ะฟะปะฐะฝ):</strong> <span id="plan-expense-value">โ โฝ</span></p>
                    <p><strong>๐ธ ะะฐััะพะด (ัะฐะบั):</strong> <span id="fact-expense-value">0 โฝ</span></p>
                    <div style="height: 6px; background: #ddd; border-radius: 3px; margin: 5px 0;">
                        <div id="progress-expense-bar" style="height: 100%; width: 0%; background: #007AFF;"></div>
                    </div>
                </div>
            </div>
            <div style="background: #e6f7ff; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>๐ ะัะพะณะธ</h3>
                <p><strong>ะะพัะพะดั:</strong> <span id="analytics-income">0 โฝ</span></p>
                <p><strong>ะะฐััะพะดั:</strong> <span id="analytics-expense">0 โฝ</span></p>
                <p><strong>ะะฐะบะพะฟะปะตะฝะพ:</strong> <span id="analytics-savings">0 โฝ</span></p>
            </div>
            <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>๐ ะขะพะฟ-3 ััะฐััะธ ัะฐััะพะดะพะฒ</h3>
                <ul id="top-expenses"></ul>
            </div>
            <h2>๐ ะะฝะฐะปะธะท</h2>
            <div style="background: #f8f8f8; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>๐ ะัะฑะตัะธัะต ะฟะตัะธะพะด</h3>
                <div style="display: grid; gap: 10px;">
                    <input type="date" id="bi-start-date"
                        style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;" />
                    <input type="date" id="bi-end-date"
                        style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;" />
                    <button onclick="updateBI()" class="btn" style="font-size: 14px; padding: 10px;">๐
                        ะะฑะฝะพะฒะธัั</button>
                </div>
            </div>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                <h3>๐ ะะฐััะพะดั ะฟะพ ะบะฐัะตะณะพัะธัะผ</h3>
                <canvas id="expensePieChart" width="400" height="300"></canvas>
            </div>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                <h3>๐ ะะพัั ะฝะฐะบะพะฟะปะตะฝะธะน ะฟะพ ะฝะตะดะตะปัะผ</h3>
                <canvas id="savingsWeeklyChart" width="400" height="300"></canvas>
            </div>
            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                <h3>๐ฏ ะัะฟะพะปะฝะตะฝะธะต ัะตะปะธ ะฝะฐะบะพะฟะปะตะฝะธะน</h3>
                <div style="position: relative; width: 200px; height: 200px; margin: 20px auto;">
                    <canvas id="goalProgressChart"></canvas>
                    <div id="goal-progress-text"
                        style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px; font-weight: bold; color: #333;">
                        0%
                    </div>
                </div>
            </div>
        </section>

        <div id="edit-section" class="edit-mode" style="display: none;">
            <h3>ะะตะดะฐะบัะธัะพะฒะฐัั</h3>
            <form id="edit-form">
                <input type="hidden" id="edit-id" />
                <input type="date" id="edit-date" required />
                <select id="edit-category" required>
                    <option value="ะะฐัะฟะปะฐัะฐ">๐ผ ะะฐัะฟะปะฐัะฐ</option>
                    <option value="ะะพะดัะฐะฑะพัะบะฐ">๐ง ะะพะดัะฐะฑะพัะบะฐ</option>
                    <option value="ะัะพะดัะบัั">๐ ะัะพะดัะบัั</option>
                    <option value="ะขัะฐะฝัะฟะพัั">๐ ะขัะฐะฝัะฟะพัั</option>
                    <option value="ะะธะปัั">๐ ะะธะปัั</option>
                    <option value="ะะฐะทะฒะปะตัะตะฝะธั">๐ฎ ะะฐะทะฒะปะตัะตะฝะธั</option>
                    <option value="ะะดะพัะพะฒัะต">๐ ะะดะพัะพะฒัะต</option>
                    <option value="ะะฑัะฐะทะพะฒะฐะฝะธะต">๐ ะะฑัะฐะทะพะฒะฐะฝะธะต</option>
                    <option value="ะะพะดะฐัะบะธ">๐ ะะพะดะฐัะบะธ</option>
                    <option value="ะัะพัะตะต">๐ฆ ะัะพัะตะต</option>
                </select>
                <input type="number" id="edit-amount" step="0.01" required />
                <select id="edit-type">
                    <option value="income">๐ข ะะพัะพะด</option>
                    <option value="expense">๐ด ะะฐััะพะด</option>
                </select>
                <select id="edit-author">
                    <option value="ะะฝัะพะฝ">๐จ ะะฝัะพะฝ</option>
                    <option value="ะะธะฑะตะบ">๐ฉ ะะธะฑะตะบ</option>
                </select>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button type="submit" class="btn success">โ๏ธ ะกะพััะฐะฝะธัั</button>
                    <button type="button" class="btn" onclick="cancelEdit()">โ ะัะผะตะฝะฐ</button>
                </div>
            </form>
        </div>

        <nav class="bottom-nav">
            <button onclick="show('home')" data-nav="home" class="nav-btn">๐<br>ะะปะฐะฒะฝะฐั</button>
            <button onclick="show('plan')" data-nav="plan" class="nav-btn">๐<br>ะะปะฐะฝ</button>
            <button onclick="show('add')" data-nav="add" class="nav-btn add-btn">โ</button>
            <button onclick="show('analytics')" data-nav="analytics" class="nav-btn">๐<br>ะััะตั</button>
            <button onclick="show('list')" data-nav="list" class="nav-btn">๐<br>ะััะพัะธั</button>
        </nav>
    </div>
    <script src="app.js"></script>
</body>
</html>
