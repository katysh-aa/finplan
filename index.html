<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>üí∞ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    <link rel="stylesheet" href="style.css" />
    <!-- –ò–∫–æ–Ω–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS –¥–ª—è Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä pull-to-refresh -->
    <div id="refresh-indicator" style="
        position: absolute;
        top: -50px;
        left: 0;
        width: 100%;
        height: 50px;
        background: white;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001;
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
    ">
        <span style="color: #007AFF; font-size: 14px;">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...</span>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <section id="auth-screen" style="text-align: center; padding: 40px 20px;">
        <h2>üîê –í—Ö–æ–¥ –≤ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å</p>
        <form id="login-form" style="display: grid; gap: 12px; max-width: 300px; margin: 20px auto;">
            <input type="email" id="login-email" placeholder="Email" required />
            <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" required />
            <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
        </form>
        <p id="auth-error" style="color: #ff3b30; height: 20px; font-size: 14px;"></p>
    </section>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="app" style="display: none;">
        <section id="home">
            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
            <div style="position: absolute; top: 20px; right: 20px; z-index: 10;">
                <button onclick="logout()" class="btn" style="
                    background: transparent;
                    color: #007AFF;
                    font-size: 14px;
                    padding: 8px 12px;
                    border: 1px solid #007AFF;
                    border-radius: 8px;
                    width: auto;
                " title="–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞">üö™</button>
            </div>
            <!-- –ö–Ω–æ–ø–∫–∏ –≤ –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
            <div style="position: absolute; top: 20px; left: 20px; z-index: 10;">
                <button onclick="refreshApp()" class="btn" style="
        background: transparent;
        color: #007AFF;
        font-size: 14px;
        padding: 8px 12px;
        border: 1px solid #007AFF;
        border-radius: 8px;
        width: auto;
    " title="–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ">üîÑ</button>
            </div>
            <h1>üí∞ –ö–æ–ø–∏–ª–∫–∞</h1>
            <div style="margin-top: 20px; padding: 12px; background: #f8f8f8; border-radius: 10px;">
                <label style="display: block; margin-bottom: 8px;"><strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ü–µ–ª—å:</strong></label>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="number" id="savings-goal" value="500000" placeholder="500000"
                        style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px;" />
                    <button onclick="saveGoal()" class="btn" style="font-size: 14px; padding: 10px 12px;">üíæ
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            <h2>üéØ –¶–µ–ª—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π</h2>
            <div
                style="background: #f0f8ff; padding: 18px; border-radius: 12px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                <p style="font-size: 28px; font-weight: bold; color: #34c759;" id="total-savings">0 ‚ÇΩ</p>
                <p style="color: #666; font-size: 14px;" id="progress-text">0% –æ—Ç —Ü–µ–ª–∏</p>
                <div style="height: 6px; background: #ddd; border-radius: 3px; overflow: hidden; margin: 10px 0;">
                    <div id="progress-fill" style="height: 100%; width: 0%; background: #34c759;"></div>
                </div>
            </div>
            <h2 style="margin-top: 30px;">üìä –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px;">
                <div style="text-align: center; background: #e6f7ff; padding: 14px; border-radius: 10px;">
                    <p style="margin: 0; color: #007AFF;"><strong>–î–æ—Ö–æ–¥</strong></p>
                    <p style="margin: 8px 0 0; font-size: 18px; color: #34c759;" id="total-income">0 ‚ÇΩ</p>
                </div>
                <div style="text-align: center; background: #fff3e0; padding: 14px; border-radius: 10px;">
                    <p style="margin: 0; color: #FF9500;"><strong>–†–∞—Å—Ö–æ–¥</strong></p>
                    <p style="margin: 8px 0 0; font-size: 18px; color: #ff3b30;" id="total-expense">0 ‚ÇΩ</p>
                </div>
            </div>
        </section>

        <section id="add" style="display: none;">
            <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</h2>
            <form id="add-form">
                <input type="date" id="date" required />
                <select id="category" required>
                    <option value="">‚Äî –ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Äî</option>
                    <option value="–ó–∞—Ä–ø–ª–∞—Ç–∞">üíº –ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                    <option value="–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞">üîß –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</option>
                    <option value="–ü—Ä–æ–¥—É–∫—Ç—ã">üõí –ü—Ä–æ–¥—É–∫—Ç—ã</option>
                    <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                    <option value="–ñ–∏–ª—å—ë">üè† –ñ–∏–ª—å—ë</option>
                    <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                    <option value="–ó–¥–æ—Ä–æ–≤—å–µ">üíä –ó–¥–æ—Ä–æ–≤—å–µ</option>
                    <option value="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                    <option value="–ü–æ–¥–∞—Ä–∫–∏">üéÅ –ü–æ–¥–∞—Ä–∫–∏</option>
                    <option value="–ü—Ä–æ—á–µ–µ">üì¶ –ü—Ä–æ—á–µ–µ</option>
                </select>
                <input type="number" id="amount" placeholder="–°—É–º–º–∞" step="0.01" required />
                <select id="type" required>
                    <option value="income">üü¢ –î–æ—Ö–æ–¥</option>
                    <option value="expense">üî¥ –†–∞—Å—Ö–æ–¥</option>
                </select>
                <select id="author" required>
                    <option value="–ê–Ω—Ç–æ–Ω">üë® –ê–Ω—Ç–æ–Ω</option>
                    <option value="–ñ–∏–±–µ–∫">üë© –ñ–∏–±–µ–∫</option>
                </select>
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
            <ul id="recent-transactions"></ul>
        </section>

        <section id="plan" style="display: none;">
            <h2>üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω</h2>
            <p style="color: #666; font-size: 14px;">–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º. –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
                –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.</p>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
                <h3>‚ûï –í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</h3>
                <form id="plan-form" style="display: grid; gap: 12px;">
                    <select id="plan-month" required
                        style="padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    </select>
                    <input type="number" id="plan-income" placeholder="–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π –¥–æ—Ö–æ–¥ (‚ÇΩ)" step="0.01" required />
                    <input type="number" id="plan-expense" placeholder="–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (‚ÇΩ)" step="0.01" required />
                    <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </form>
            </div>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.1);">
                <h3>üì• –ò–º–ø–æ—Ä—Ç –∏–∑ Excel</h3>
                <p style="font-size: 14px; color: #666;">–§–æ—Ä–º–∞—Ç: <code>–ú–µ—Å—è—Ü (–ì–ì–ì–ì-–ú–ú), –î–æ—Ö–æ–¥, –†–∞—Å—Ö–æ–¥</code></p>
                <input type="file" id="import-plan-file" accept=".xlsx, .xls" />
                <button onclick="importPlanFromExcel()" class="btn"
                    style="font-size: 14px; padding: 10px; margin-top: 8px;">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
            <h3>üìã –¢–µ–∫—É—â–∏–µ –ø–ª–∞–Ω—ã</h3>
            <ul id="plan-list"></ul>
        </section>

        <section id="list" style="display: none;">
            <h2>üìã –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
            <div style="display: grid; gap: 10px; margin: 10px 0;">
                <input type="date" id="filter-start" placeholder="–° –¥–∞—Ç—ã" />
                <input type="date" id="filter-end" placeholder="–ü–æ –¥–∞—Ç—É" />
            </div>
            <div style="margin: 10px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="filterByDate()" class="btn"
                    style="font-size: 14px; padding: 10px; flex: 1; min-width: 120px;">üîç
                    –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
                <button onclick="clearFilter()" class="btn"
                    style="font-size: 14px; padding: 10px; flex: 1; min-width: 120px; background: #555;">üóëÔ∏è
                    –°–±—Ä–æ—Å–∏—Ç—å</button>
                <button onclick="exportToExcel()" class="btn" style="font-size: 14px; background: #2e74b5;">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤
                    Excel</button>
            </div>
            <ul id="all-transactions"></ul>
        </section>

        <section id="analytics" style="display: none;">
            <h2>üìà –û—Ç—á–µ—Ç</h2>
            <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>üéØ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω –Ω–∞ –º–µ—Å—è—Ü</h3>
                <p><strong>üìÖ –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü:</strong> <span id="current-month">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                <div style="margin-top: 10px; padding: 10px; background: #e6f7ff; border-radius: 8px;">
                    <p><strong>üíº –î–æ—Ö–æ–¥ (–ø–ª–∞–Ω):</strong> <span id="plan-income-value">‚Äî ‚ÇΩ</span></p>
                    <p><strong>üíº –î–æ—Ö–æ–¥ (—Ñ–∞–∫—Ç):</strong> <span id="fact-income-value">0 ‚ÇΩ</span></p>
                    <div style="height: 6px; background: #ddd; border-radius: 3px; margin: 5px 0;">
                        <div id="progress-income-bar" style="height: 100%; width: 0%; background: #34c759;"></div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 8px;">
                    <p><strong>üí∏ –†–∞—Å—Ö–æ–¥ (–ø–ª–∞–Ω):</strong> <span id="plan-expense-value">‚Äî ‚ÇΩ</span></p>
                    <p><strong>üí∏ –†–∞—Å—Ö–æ–¥ (—Ñ–∞–∫—Ç):</strong> <span id="fact-expense-value">0 ‚ÇΩ</span></p>
                    <div style="height: 6px; background: #ddd; border-radius: 3px; margin: 5px 0;">
                        <div id="progress-expense-bar" style="height: 100%; width: 0%; background: #007AFF;"></div>
                    </div>
                </div>
            </div>
            <div style="background: #e6f7ff; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>üìä –ò—Ç–æ–≥–∏</h3>
                <p><strong>–î–æ—Ö–æ–¥—ã:</strong> <span id="analytics-income">0 ‚ÇΩ</span></p>
                <p><strong>–†–∞—Å—Ö–æ–¥—ã:</strong> <span id="analytics-expense">0 ‚ÇΩ</span></p>
                <p><strong>–ù–∞–∫–æ–ø–ª–µ–Ω–æ:</strong> <span id="analytics-savings">0 ‚ÇΩ</span></p>
            </div>
            <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>üìâ –¢–æ–ø-3 —Å—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
                <ul id="top-expenses"></ul>
            </div>
            <h2>üìä –ê–Ω–∞–ª–∏–∑</h2>
            <div style="background: #f8f8f8; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</h3>
                <div style="display: grid; gap: 10px;">
                    <input type="date" id="bi-start-date"
                        style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;" />
                    <input type="date" id="bi-end-date"
                        style="padding: 10px; border: 1px solid #ddd; border-radius: 8px;" />
                    <button onclick="updateBI()" class="btn" style="font-size: 14px; padding: 10px;">üìà
                        –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                <h3>üìâ –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                <canvas id="expensePieChart" width="400" height="300"></canvas>
            </div>
            <div
                style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                <h3>üìà –†–æ—Å—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π –ø–æ –Ω–µ–¥–µ–ª—è–º</h3>
                <canvas id="savingsWeeklyChart" width="400" height="300"></canvas>
            </div>
            <div style="background: white; padding: 15px; border-radius: 10px; text-align: center;">
                <h3>üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ª–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π</h3>
                <div style="position: relative; width: 200px; height: 200px; margin: 20px auto;">
                    <canvas id="goalProgressChart"></canvas>
                    <div id="goal-progress-text"
                        style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px; font-weight: bold; color: #333;">
                        0%
                    </div>
                </div>
            </div>
        </section>

        <div id="edit-section" class="edit-mode" style="display: none;">
            <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
            <form id="edit-form">
                <input type="hidden" id="edit-id" />
                <input type="date" id="edit-date" required />
                <select id="edit-category" required>
                    <option value="–ó–∞—Ä–ø–ª–∞—Ç–∞">üíº –ó–∞—Ä–ø–ª–∞—Ç–∞</option>
                    <option value="–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞">üîß –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞</option>
                    <option value="–ü—Ä–æ–¥—É–∫—Ç—ã">üõí –ü—Ä–æ–¥—É–∫—Ç—ã</option>
                    <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                    <option value="–ñ–∏–ª—å—ë">üè† –ñ–∏–ª—å—ë</option>
                    <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">üéÆ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
                    <option value="–ó–¥–æ—Ä–æ–≤—å–µ">üíä –ó–¥–æ—Ä–æ–≤—å–µ</option>
                    <option value="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                    <option value="–ü–æ–¥–∞—Ä–∫–∏">üéÅ –ü–æ–¥–∞—Ä–∫–∏</option>
                    <option value="–ü—Ä–æ—á–µ–µ">üì¶ –ü—Ä–æ—á–µ–µ</option>
                </select>
                <input type="number" id="edit-amount" step="0.01" required />
                <select id="edit-type">
                    <option value="income">üü¢ –î–æ—Ö–æ–¥</option>
                    <option value="expense">üî¥ –†–∞—Å—Ö–æ–¥</option>
                </select>
                <select id="edit-author">
                    <option value="–ê–Ω—Ç–æ–Ω">üë® –ê–Ω—Ç–æ–Ω</option>
                    <option value="–ñ–∏–±–µ–∫">üë© –ñ–∏–±–µ–∫</option>
                </select>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button type="submit" class="btn success">‚úîÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn" onclick="cancelEdit()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>

        <nav class="bottom-nav">
            <button onclick="show('home')" data-nav="home" class="nav-btn">üè†<br>–ì–ª–∞–≤–Ω–∞—è</button>
            <button onclick="show('plan')" data-nav="plan" class="nav-btn">üìä<br>–ü–ª–∞–Ω</button>
            <button onclick="show('add')" data-nav="add" class="nav-btn add-btn">‚ûï</button>
            <button onclick="show('analytics')" data-nav="analytics" class="nav-btn">üìà<br>–û—Ç—á–µ—Ç</button>
            <button onclick="show('list')" data-nav="list" class="nav-btn">üìã<br>–ò—Å—Ç–æ—Ä–∏—è</button>
        </nav>
    </div>
    <script src="app.js"></script>
</body>

</html>
